@import java.time.format.{DateTimeFormatter, FormatStyle}
@(user: User, currentPage: com.avaje.ebean.PagedList[Exercise], currentOrderBy: Int, currentTitleFilter: String, currentTagFilter: String)
@****************************************
* Helper generating navigation links *
****************************************@
@link(newPage: Int, newOrderBy: Int) = @{
    routes.ExerciseController.renderList(newPage, newOrderBy, currentTitleFilter, currentTagFilter)
}

    @**********************************
    * Helper generating table headers *
    ***********************************@
@header(orderBy: Int, title: String) = {
    <th class="col@orderBy header @if(currentOrderBy == orderBy) @{
        if(currentOrderBy == orderBy) "headerSortDown" else "headerSortUp"
    }">
        <a href="@link(0, if(currentOrderBy == orderBy) -orderBy else orderBy)">@title</a>
    </th>
}

@main("Aufgaben", user) {
    <h1>Aufgaben Übersicht</h1>

    <script src="@routes.Assets.versioned("javascripts/jquery.tokeninput.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/exerciselist.js")" type="text/javascript"></script>
    <form method="GET" action="@routes.ExerciseController.renderList()" class="form-horizontal">
        <input type="hidden" name="sort" value="@currentOrderBy" />
        <input type="search" class="form-control" id="title-filter" name="title" value="@currentTitleFilter" placeholder="Titel-Filter"/>
        <p>Tag-Filter: </p>
        <input type="search" class="form-control" id="tag-filter-list" name="tags" value="@currentTagFilter" placeholder="Tag-Filter" data-route="@routes.TagController.suggestAllTags("")"/>
        <input type="submit" class="btn btn-primary btn-default" id="submit-filter" value="Suche"/>
    </form>

    Sortieren nach:
    <div class="table table-striped ">
        <thead class="thead-inverse">
            <tr>
                @header(1, "Titel")
                @header(2, "Lösungen")
                @header(3, "Bewertung")
                @header(4, "Datum")
            </tr>
        </thead>
        <tbody>
    </div>
    @for(exercise <- currentPage.getList) {
        <a href="@routes.ExerciseDetailController.renderExerciseDetail(exercise.getId)">
            <div class="list  @if(exercise.getPoints < 0) {
                item-red
            } else {
                @if(exercise.getPoints > 0) {
                    item-green
                } else { item-blue}
            }">
                <span class="item">
                    <p class="title">@exercise.getTitle</p>
                    <p class="meta tag maintag">@exercise.getTagsSortedByTagType.filter(x => x.isMainTag).map(x => x.getName).mkString(", ") </p>
                    <p class="meta tag">@exercise.getTagsSortedByTagType.filter(x => !x.isMainTag).map(x => x.getName).mkString(", ")</p>
                </span>

                <span><a class="meta user" href="@routes.UserController.renderUser(exercise.getUser.getId)">@exercise.getUser.getUsername</a></span>
                <span class="text-center meta solutioncount">
                @exercise.getSolutions.size
                </span>
                <span class="text-center meta points">
                @exercise.getPoints
                </span>
                <span class="meta time">
                @exercise.getTime().format(DateTimeFormatter.ofLocalizedDateTime(FormatStyle.SHORT).withLocale(Locale.GERMAN))
                </span>
            </div>
        </a>
    }

    <div id="pagination" class="pagination">
        <div>
        @if(currentPage.hasPrev) {
            <div class="prev">
                <a href="@link(currentPage.getPageIndex - 1, currentOrderBy)">&larr; Vorherige</a>
            </div>
        } else {
            <div class="prev disabled">
                <a>&larr; Vorherige</a>
            </div>
        }
        </div>
        <div>
        @if(currentPage.hasNext) {
            <div class="next">
                <a href="@link(currentPage.getPageIndex + 1, currentOrderBy)">Nächste &rarr;</a>
            </div>
        } else {
            <div class="next disabled">
                <a>Nächste &rarr;</a>
            </div>
        }
        </div>
        <div class="current">
            <p>Zeige @currentPage.getDisplayXtoYofZ(" bis ", " von ") an</p>
        </div>
    </div>
}