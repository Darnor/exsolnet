@import java.time.format.{DateTimeFormatter, FormatStyle}
@(user: User, currentPage: com.avaje.ebean.PagedList[Exercise], currentOrderBy: Int, currentTitleFilter: String, currentTagFilter: String)

@****************************************
* Helper generating sorting links       *
****************************************@
@link(newPage: Int, newOrderBy: Int) = @{
    routes.ExerciseController.renderList(newPage, newOrderBy, currentTitleFilter, currentTagFilter)
}

@sortingfield(orderBy: Int, title: String) = {
    <div  class="@if(Math.abs(currentOrderBy) == orderBy) @{"selected"}">
        <a class="btn @if(Math.abs(currentOrderBy) == orderBy) @{"selected"}" href="@link(0, if(currentOrderBy == orderBy) -orderBy else orderBy)">@title
            @if(Math.abs(currentOrderBy) == orderBy) @{
                if(currentOrderBy == orderBy)
                    <span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                else
                    <span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>
            }</a>
    </div>
}

@main("Aufgaben", user) {
    <h1>Aufgaben Übersicht</h1>

    <script src="@routes.Assets.versioned("javascripts/jquery.tokeninput.js")" type="text/javascript"></script>
    <script src="@routes.Assets.versioned("javascripts/exerciselist.js")" type="text/javascript"></script>
    <form method="GET" action="@routes.ExerciseController.renderList()" class="form-horizontal">
        <input type="hidden" name="sort" value="@currentOrderBy" />
        <input type="search" class="form-control" id="title-filter" name="title" value="@currentTitleFilter" placeholder="Titel-Filter"/>
        <p>Tag-Filter: </p>
        <input type="search" class="form-control" id="tag-filter-list" name="tags" value="@currentTagFilter" placeholder="Tag-Filter" data-route="@routes.TagController.processTagNameQuery("")"/>
        <input type="submit" class="btn btn-primary btn-default" id="submit-filter" value="Suche"/>
    </form>

    Sortieren nach:
    <div class="display-inline">
        @sortingfield(1, "Titel")
        @sortingfield(2, "Lösungen")
        @sortingfield(3, "Bewertung")
        @sortingfield(4, "Datum")
    </div>

    @for(exercise <- currentPage.getList) {
        <a href="@routes.ExerciseDetailController.renderExerciseDetail(exercise.getId)">
            <div class="list  @if(exercise.getPoints < 0) {
                item-red
            } else {
                @if(exercise.getPoints > 0) {
                    item-green
                } else { item-blue}
            }">
                <span class="item">
                    <p class="title">@exercise.getTitle</p>
                    <p class="meta tag maintag">@exercise.getTagsSortedByTagType.filter(x => x.isMainTag).map(x => x.getName).mkString(", ") </p>
                    <p class="meta tag">@exercise.getTagsSortedByTagType.filter(x => !x.isMainTag).map(x => x.getName).mkString(", ")</p>
                </span>

                <span><a class="meta user" href="@routes.UserController.renderUser(exercise.getUser.getId)">@snippets.gravatar(exercise.getUser, 16) @exercise.getUser.getUsername</a></span>
                <span class="text-center meta solutioncount">
                @exercise.getSolutions.size
                </span>
                <span class="text-center meta points">
                @exercise.getPoints
                </span>
                <span class="meta time">
                @exercise.getTime().format(DateTimeFormatter.ofLocalizedDateTime(FormatStyle.SHORT).withLocale(Locale.GERMAN))
                </span>
            </div>
        </a>
    }

    <div id="pagination" class="pagination">
        <div class="display-inline">
            <div>
                <a class="btn prev@if(!currentPage.hasPrev) { disabled}" href="@link(currentPage.getPageIndex - 1, currentOrderBy)">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Vorherige
                </a>
            </div>
            <div>
                <a class="btn next@if(!currentPage.hasNext) { disabled}" href="@link(currentPage.getPageIndex + 1, currentOrderBy)">
                    Nächste<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                </a>
            </div>
        </div>
        <div class="current">
            <p>Zeige @currentPage.getDisplayXtoYofZ(" bis ", " von ") an</p>
        </div>
    </div>
}